



2023-04-12
--------------------------------------------------------------------------------------------
1、在MBCH11单板验证结果:

# ./usrPalTest.static
pal_read OK!
physical_info.pal_data_addr = 0x40000000.
physical_info.pal_data_len  = 0x1000.
base addr:0x40000000
mmap successful ! mem is 0x76fc4000f,offset is 0
===========main=================
0x0000000000000000:0x01 0x00 0x00 0x00 0x01 0x00 0x00 0x00 0x10 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000010:0x00 0x00 0x00 0x00 0x40 0x9c 0x00 0x00 0xff 0xff 0xff 0xff 0x00 0x00 0x00 0x00
0x0000000000000020:0x60 0x10 0x00 0x00 0x00 0x00 0x00 0x00 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x0000000000000030:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x0000000000000040:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x0000000000000050:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x0000000000000060:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x0000000000000070:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x0000000000000080:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x0000000000000090:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x00000000000000a0:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x00000000000000b0:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x00000000000000c0:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x00000000000000d0:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x00000000000000e0:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
0x00000000000000f0:0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
#

# devmem 0x40000000 w
0x00000001
# devmem 0x40000004 w
0x00000001
# devmem 0x40000008 w
0x00000010
# devmem 0x4000000c w
0x00000000
# devmem 0x40000014 w
0x00009C40



2023-04-11
---------------------------------------------------------------------------------------------
1、usrPal.c文件编译出静态库，主要功能包括：
（1）pal_dma_mmap函数，打开/dev/mem，在对物理地址（作为偏移）进行mmap映射，实现用户态对物理内存进行访问功能。
（2）pal_dma_munmap函数，解除物理地址映射功能。
（3）编译出静态库供上层用户调用。
（4）pal_read函数，/dev/pal0或者/dev/asi0设备阻塞读接口，对外接口。

2、usrPalTest.c文件是测试代码。

3、在ubuntu 16.04虚拟机测试结果:
(1) insmod pal.ko
(2) 在一个shell中输入: ./usrPalTest.static (比3先输入)
(3) 在另一个shell中输入:echo "0" > dev.pal0 (pal驱动写接口构造模拟中断上报)

root@ubuntu:/home/share/Linux-App/usrPalTest# ./usrPalTest.static
base addr:0x90000
mmap successful ! mem is 0x7fdbec913000f,offset is 0
0x0000000000000000:0x8c 0x2d 0xd6 0xed 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000010:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000020:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000030:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000040:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000050:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000060:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000070:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000080:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x0000000000000090:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x00000000000000a0:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x00000000000000b0:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x00000000000000c0:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x00000000000000d0:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x00000000000000e0:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
0x00000000000000f0:0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

（4）devmem2工具实际读取内存数据，与（3）中读出的数据做对比测试，验证pal驱动和封装的接口功能是正确的。

root@ubuntu:/home/share/Linux-App/usrPalTest# devmem2 0x90000 w
/dev/mem opened.
Memory mapped at address 0x7f2288826000.
Value at address 0x90000 (0x7f2288826000): 0xEDD62D8C

